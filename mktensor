#!/bin/bash
# Build TensorRT-LLM (incremental) - RTX 3090 (SM86) only
# For clean builds, use ./mktensor-clean instead

cd /home/steve/src/shepherd/TensorRT-LLM

export PATH=/home/steve/.local/bin:/usr/local/cuda-13.0/bin:$PATH
export CUDA_HOME=/usr/local/cuda-13.0
export TORCH_CUDA_ARCH_LIST="8.6"

# Incremental build - only rebuilds changed files
# Disable ENABLE_MULTI_DEVICE to skip userbuffers (NCCL incompatibility)
time python3.12 scripts/build_wheel.py \
    --cpp_only \
    --build_type=Release \
    --no-venv \
    --cuda_architectures="86-real" \
    --fast_build \
    --extra-cmake-vars="-DENABLE_MULTI_DEVICE=OFF"
